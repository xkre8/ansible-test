---
- name: Check if Java exists
  command: java -version
  register: java_check
  ignore_errors: yes

- name: Install Java if not found
  when: java_check.rc != 0
  block:
    - name: Download Azul Java
      get_url:
        url: "{{ java_urls[java_version] }}"
        dest: "/tmp/java.tar.gz"
    
    - name: Create Java folder
      file:
        path: "{{ java_home }}"
        state: directory
        
    - name: Extract Java
      unarchive:
        src: "/tmp/java.tar.gz"
        dest: "{{ java_home }}"
        remote_src: yes
        strip_components: 1
        
    - name: Set Java PATH
      lineinfile:
        path: /etc/profile.d/java.sh
        line: "{{ item }}"
        create: yes
      with_items:
        - "export JAVA_HOME={{ java_home }}"
        - "export PATH={{ java_home }}/bin:$PATH"
        
    - name: Clean up download
      file:
        path: "/tmp/java.tar.gz"
        state: absent
