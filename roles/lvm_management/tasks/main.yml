---
# === MAIN ORCHESTRATOR ===
- name: Install required packages
  ansible.builtin.package:
    name: [lvm2, xfsprogs, e2fsprogs, parted]
    state: present

- name: "🔍 PHASE 1: Validation"
  ansible.builtin.include_tasks: validate.yml

- name: "🔧 PHASE 2: Partition Creation"
  ansible.builtin.include_tasks: create_partition.yml
  when: partition_strategy == 'create_partition'

- name: "📦 PHASE 3: Volume Group Creation"
  ansible.builtin.include_tasks: create_vg.yml

- name: "💾 PHASE 4: Filesystem & LV Creation"
  ansible.builtin.include_tasks: create_fs_lv.yml
  when: parsed_fs_config | length > 0 or (split_disk and create_secondary_filesystem and parsed_fs_config2 | length > 0)

- name: "📊 PHASE 5: Summary Report"
  ansible.builtin.include_tasks: summary.yml