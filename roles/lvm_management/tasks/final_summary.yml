---
- name: Get Physical Volume information (when disk is used)
  ansible.builtin.command: pvs --noheadings "{{ lvm_device }}" -o pv_name,vg_name,pv_size,pv_free
  register: pv_info
  changed_when: false
  failed_when: false
  when: 
    - lvm_device is defined and lvm_device != ""
    - vg_strategy in ['create_new', 'extend_existing']

- name: Get Volume Group detailed information  
  ansible.builtin.command: vgs --noheadings "{{ volume_group_name }}" -o vg_name,pv_count,lv_count,vg_size,vg_free
  register: vg_detailed_info
  changed_when: false
  failed_when: false

- name: Get Logical Volume information
  ansible.builtin.command: lvs --noheadings "{{ volume_group_name }}" -o lv_name,lv_size,lv_path
  register: lv_info
  changed_when: false
  failed_when: false

- name: Display comprehensive LVM summary with strategy context
  ansible.builtin.debug:
    msg: |
      
      ğŸ¯ ===== LVM SETUP SUMMARY =====
      
      ğŸ“‹ Strategy Used: {{ vg_strategy | upper }}
      {% if vg_strategy == 'create_new' %}
      âœ¨ Created new Volume Group with fresh disk
      {% elif vg_strategy == 'extend_existing' %}
      ğŸ“ˆ Extended existing Volume Group with additional disk
      {% elif vg_strategy == 'use_existing' %}
      ğŸ”„ Used existing Volume Group (no disk operations)
      {% endif %}
      
      {% if vg_strategy in ['create_new', 'extend_existing'] %}
      ğŸ“€ Physical Volume (PV):
      {{ pv_info.stdout if pv_info.stdout is defined else 'No PV information available' }}
      {% endif %}
      
      ğŸ“¦ Volume Group (VG):
      {{ vg_detailed_info.stdout if vg_detailed_info.stdout is defined else 'No VG information available' }}
      
      ğŸ’¾ Logical Volumes (LV):
      {% if lv_info.stdout_lines is defined %}
      {% for lv in lv_info.stdout_lines %}
      {{ lv }}
      {% endfor %}
      {% else %}
      No LV information available
      {% endif %}
      
      ğŸ—‚ï¸  Mounted Filesystems:
      {% for item in filesystem_dirs %}
      {% if item.create_lvm | default(false) %}
      - {{ item.lv_name }}: {{ item.path }} ({{ item.size_mb }}MB, {{ item.fstype }})
      {% endif %}
      {% endfor %}
      
      âœ… LVM setup completed successfully with {{ vg_strategy }} strategy!