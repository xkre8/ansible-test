---
# === COLLECT FINAL INFORMATION ===
- name: Get final LVM information
  ansible.builtin.shell: |
    echo "=== VOLUME GROUPS ==="
    vgs {{ volume_group_name }} {{ volume_group2_name if split_disk else '' }} 2>/dev/null || echo "VG info unavailable"
    echo ""
    echo "=== LOGICAL VOLUMES ==="
    lvs {{ volume_group_name }} {{ volume_group2_name if split_disk else '' }} 2>/dev/null || echo "LV info unavailable"
    echo ""
    echo "=== MOUNTED FILESYSTEMS ==="
    {% set all_paths = [] %}
    {% if primary_fs_dirs is defined %}
      {% for item in primary_fs_dirs %}
        {% set _ = all_paths.append(item.path) %}
      {% endfor %}
    {% endif %}
    {% if split_disk and secondary_fs_dirs is defined %}
      {% for item in secondary_fs_dirs %}
        {% set _ = all_paths.append(item.path) %}
      {% endfor %}
    {% endif %}
    {% if all_paths | length > 0 %}
    df -h {{ all_paths | join(' ') }} 2>/dev/null || echo "Mount info unavailable"
    {% else %}
    echo "No filesystems configured"
    {% endif %}
  register: final_lvm_info
  changed_when: false

# === DISPLAY COMPREHENSIVE SUMMARY ===
- name: Display comprehensive summary
  ansible.builtin.debug:
    msg: |
      
      ğŸ‰ LVM INFRASTRUCTURE SETUP COMPLETE! ğŸ‰
      
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      ğŸ“Š CONFIGURATION SUMMARY
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      ğŸ”§ Strategy: CREATE NEW
      ğŸ“€ Target Disk: {{ base_disk }} ({{ disk_size_gb }}GB)
      ğŸ“Š Partition Strategy: {{ partition_strategy }}
      ğŸ”€ Split Disk: {{ 'YES' if split_disk else 'NO' }}
      
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      ğŸ“¦ VOLUME GROUPS CREATED
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      ğŸ·ï¸  Primary VG: {{ volume_group_name }}
         ğŸ“ Device: {{ primary_device }}
         ğŸ’¾ Filesystems: {{ primary_fs_dirs | length if primary_fs_dirs is defined else 0 }}
      
      {% if split_disk %}
      ğŸ·ï¸  Secondary VG: {{ volume_group2_name }}
         ğŸ“ Device: {{ secondary_device }}
         ğŸ’¾ Filesystems: {{ secondary_fs_dirs | length if secondary_fs_dirs is defined else 0 }}
      {% endif %}
      
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      ğŸ’¾ FILESYSTEMS CREATED
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      {% if primary_fs_dirs is defined %}
      ğŸ—‚ï¸  Primary VG ({{ volume_group_name }}):
      {% for fs in primary_fs_dirs %}
         ğŸ“ {{ fs.path }} ({{ fs.size_mb }}MB, {{ fs.fstype }})
      {% endfor %}
      {% endif %}
      
      {% if split_disk and secondary_fs_dirs is defined %}
      ğŸ—‚ï¸  Secondary VG ({{ volume_group2_name }}):
      {% for fs in secondary_fs_dirs %}
         ğŸ“ {{ fs.path }} ({{ fs.size_mb }}MB, {{ fs.fstype }})
      {% endfor %}
      {% endif %}
      
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      ğŸ“ˆ SYSTEM INFORMATION
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      {{ final_lvm_info.stdout }}
      
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      âœ… STATUS: ALL OPERATIONS COMPLETED SUCCESSFULLY
      ğŸ• Execution completed at: {{ ansible_date_time.iso8601 }}
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•