---
- name: Get comprehensive LVM information
  ansible.builtin.shell: |
    echo "=== VOLUME GROUPS ==="
    if vgs "{{ volume_group_name }}" 2>/dev/null; then
      vgs "{{ volume_group_name }}"
    else
      echo "âŒ VG '{{ volume_group_name }}' not found"
    fi
    echo ""
    
    echo "=== PHYSICAL VOLUMES ==="
    if pvs 2>/dev/null | grep "{{ volume_group_name }}"; then
      pvs | grep "{{ volume_group_name }}"
    else
      echo "âŒ No PVs found for VG '{{ volume_group_name }}'"
    fi
    echo ""
    
    echo "=== LOGICAL VOLUMES ==="
    if lvs "{{ volume_group_name }}" 2>/dev/null; then
      lvs "{{ volume_group_name }}"
    else
      echo "âŒ No LVs found for VG '{{ volume_group_name }}'"
    fi
    echo ""
    
    echo "=== MOUNT POINTS ==="
    {% if filesystem_dirs | length > 0 %}
    df -h {{ filesystem_dirs | map(attribute='path') | join(' ') }} 2>/dev/null || echo "âŒ Mount info unavailable"
    {% else %}
    echo "âŒ No filesystems configured"
    {% endif %}
    echo ""
    
    echo "=== DISK USAGE ==="
    {% if filesystem_dirs | length > 0 %}
    du -sh {{ filesystem_dirs | map(attribute='path') | join(' ') }} 2>/dev/null || echo "âŒ Usage info unavailable"
    {% endif %}
  register: lvm_info
  changed_when: false
  failed_when: false

- name: Display comprehensive LVM summary
  ansible.builtin.debug:
    msg: |
      
      ğŸ¯ LVM SETUP COMPLETE! 
      ========================
      Strategy: {{ vg_strategy | upper }}
      PV Strategy: {{ pv_strategy | upper }}
      Volume Group: {{ volume_group_name }}
      Target Device: {{ target_device | default('N/A') }}
      
      ğŸ“ˆ STORAGE DETAILS:
      {{ lvm_info.stdout }}
      
      âœ… Configuration Applied Successfully!