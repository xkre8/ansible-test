---
- name: "Display user report grouped by SR"
  ansible.builtin.debug:
    msg: |
      
      ðŸŽ¯ === USER CREATION REPORT === ðŸŽ¯
      
      Total users created: {{ processed_users | default([]) | length }}
      
      ðŸ“‹ Service Requests Summary:
      {% for sr_num in processed_users | map(attribute='sr_number') | unique %}
      {% if sr_num != '' %}
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      ðŸ“ž {{ sr_num }} - {{ (processed_users | selectattr('sr_number', '==', sr_num) | first).owner_name }} ({{ (processed_users | selectattr('sr_number', '==', sr_num) | first).tel }})
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      {% for user in processed_users | selectattr('sr_number', '==', sr_num) %}
      ðŸ‘¤ {{ user.name }}{% if user.random_username %} (ðŸŽ² Generated){% endif %}
        â”œâ”€â”€ UID: {{ user.uid }}{% if user.random_uid %} (ðŸŽ² Random){% endif %}
        â”œâ”€â”€ Purpose: {{ user.purpose if user.purpose != '' else 'Not specified' }}   # â† à¹€à¸žà¸´à¹ˆà¸¡à¸šà¸£à¸£à¸—à¸±à¸”à¸™à¸µà¹‰
        â”œâ”€â”€ Group: {{ user.group }}
        â”œâ”€â”€ Additional Groups: {{ user.groups | join(', ') if user.groups | length > 0 else 'None' }}
        â”œâ”€â”€ Home: {{ user.home }}
        â”œâ”€â”€ Shell: {{ user.shell }}
        â”œâ”€â”€ Description: {{ user.comment }}
        â””â”€â”€ Password: {% if user.random_password %}ðŸŽ² {{ user.password }} (SAVE THIS!){% else %}âœ… User Provided{% endif %}
      
      {% endfor %}
      {% endif %}
      {% endfor %}
  when: processed_users is defined and processed_users | length > 0